function distance(a,t,h,M){var n=Math.PI*a/180,s=Math.PI*h/180,c=t-M,o=Math.PI*c/180,i=Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(o);return i=Math.acos(i),i=180*i/Math.PI,i=60*i*1.1515,i=Math.round(i)}
function initialize(){var e=37.09024,o=-95.712891,s=new google.maps.LatLng(e,o),r={zoom:4,center:s},t=new google.maps.Map(document.getElementById("map"),r),n=new google.maps.Geocoder;setMarkers(t),setNetworkLine(t,serverLocs[0],serverLocs[1],"red",!0),setNetworkLine(t,serverLocs[1],serverLocs[2],"red",!0),setNetworkLine(t,serverLocs[2],serverLocs[7],"red",!0),setNetworkLine(t,serverLocs[2],serverLocs[3],"red",!0),setNetworkLine(t,serverLocs[3],serverLocs[7],"red",!0),setNetworkLine(t,serverLocs[3],serverLocs[4],"red",!0),setNetworkLine(t,serverLocs[4],serverLocs[6],"red",!0),setNetworkLine(t,serverLocs[6],serverLocs[5],"red",!0),setNetworkLine(t,serverLocs[5],serverLocs[0],"red",!0),document.getElementById("serverNames").options[0]=new Option("Please select an address");for(var l=0;l<serverLocs.length;l++){var a=serverLocs[l];document.getElementById("serverNames").options[l+1]=new Option(a.name)}document.getElementById("submit").addEventListener("click",function(){geocodeAddress(n,t)})}function setMarkers(e){for(var o={coords:[1,1,1,20,18,20,18,1],type:"poly"},s=0;s<serverLocs.length;s++){var r=serverLocs[s];new google.maps.Marker({position:{lat:r.lat,lng:r.lng},map:e,shape:o,title:r.name})}}function setNetworkLine(e,o,s,r,t){var n=o.lat,l=o.lng,a=s.lat,c=s.lng;latLng1=new google.maps.LatLng(n,l),latLng2=new google.maps.LatLng(a,c);var i=[{lat:n,lng:l},{lat:a,lng:c}],g=new google.maps.Polyline({path:i,geodesic:!0,strokeColor:r,strokeOpacity:1,strokeWeight:2});if(g.setMap(e),t){inBetween=google.maps.geometry.spherical.interpolate(latLng1,latLng2,.5);var v=distance(n,l,a,c),d=new MapLabel({text:v+" mi",position:inBetween,map:e,fontSize:20});d.set("position",inBetween)}}function geocodeAddress(e,o){var s=document.getElementById("clientAddress").value,r=document.getElementById("serverNames"),t=r.options[r.selectedIndex].value;console.log("serverName: ",t),e.geocode({address:s},function(e,s){if(s===google.maps.GeocoderStatus.OK){clientLoc={lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()},clientLat=e[0].geometry.location.lat(),clientLng=e[0].geometry.location.lng();new google.maps.Marker({map:o,position:e[0].geometry.location});closestObj=findClosestServer(clientLoc.lat,clientLoc.lng),setNetworkLine(o,clientLoc,closestObj.server,"green",!1),closestObj.server.name==t?console.log("You chose the closest server"):(console.log("your server is not the closest"),findShortestRoute(closestObj.server.name,t))}else alert("Geocode was not successful for the following reason: "+s)})}function findClosestServer(e,o){for(var s={},r=[],t=0,n={},l=0;l<serverLocs.length;l++){var a=serverLocs[l];r[l]=distance(e,o,a.lat,a.lng)}t=r[0],s=serverLocs[0];for(var l=1;l<r.length;l++)r[l]<t&&(t=r[l],s=serverLocs[l]);return n={dist:t,server:s}}function findShortestRoute(e,o){console.log("findShortestRoute hit!"),console.log("server1 is: ",e),console.log("server2 is: ",o);var s=!1,r=["Atlanta","Dallas","Los Angeles","Seattle","Chicago","New York","Washington DC"];if("Miami"!=e||"Miami"!=o)for(var t=0;t<r.length;t++)if(e==r[t]){console.log("route1[i] matches server 1: ",r[t]);for(var n=t+1;n<r.length;n++){if(o==r[n]){console.log("route1[j] matches server 2: ",r[n]),s=!0;break}console.log("route1[j] does not match server2; keep looping: ",r[n])}if(!s)for(var n=0;n<r.length;n++){if(o==r[n]){console.log("route1[j] matches server 2: ",r[n]),s=!0;break}console.log("route1[j] does not match server2; keep looping: ",r[n])}}}google.maps.event.addDomListener(window,"load",initialize);
function MapLabel(t){this.set("fontFamily","sans-serif"),this.set("fontSize",12),this.set("fontColor","#000000"),this.set("strokeWeight",4),this.set("strokeColor","#ffffff"),this.set("align","center"),this.set("zIndex",1e3),this.setValues(t)}MapLabel.prototype=new google.maps.OverlayView,window.MapLabel=MapLabel,MapLabel.prototype.changed=function(t){switch(t){case"fontFamily":case"fontSize":case"fontColor":case"strokeWeight":case"strokeColor":case"align":case"text":return this.drawCanvas_();case"maxZoom":case"minZoom":case"position":return this.draw()}},MapLabel.prototype.drawCanvas_=function(){var t=this.canvas_;if(t){var e=t.style;e.zIndex=this.get("zIndex");var a=t.getContext("2d");a.clearRect(0,0,t.width,t.height),a.strokeStyle=this.get("strokeColor"),a.fillStyle=this.get("fontColor"),a.font=this.get("fontSize")+"px "+this.get("fontFamily");var o=Number(this.get("strokeWeight")),i=this.get("text");if(i){o&&(a.lineWidth=o,a.strokeText(i,o,o)),a.fillText(i,o,o);var s=a.measureText(i),n=s.width+o;e.marginLeft=this.getMarginLeft_(n)+"px",e.marginTop="-0.4em"}}},MapLabel.prototype.onAdd=function(){var t=this.canvas_=document.createElement("canvas"),e=t.style;e.position="absolute";var a=t.getContext("2d");a.lineJoin="round",a.textBaseline="top",this.drawCanvas_();var o=this.getPanes();o&&o.mapPane.appendChild(t)},MapLabel.prototype.onAdd=MapLabel.prototype.onAdd,MapLabel.prototype.getMarginLeft_=function(t){switch(this.get("align")){case"left":return 0;case"right":return-t}return t/-2},MapLabel.prototype.draw=function(){var t=this.getProjection();if(t&&this.canvas_){var e=this.get("position");if(e){var a=t.fromLatLngToDivPixel(e),o=this.canvas_.style;o.top=a.y+"px",o.left=a.x+"px",o.visibility=this.getVisible_()}}},MapLabel.prototype.draw=MapLabel.prototype.draw,MapLabel.prototype.getVisible_=function(){var t=this.get("minZoom"),e=this.get("maxZoom");if(void 0===t&&void 0===e)return"";var a=this.getMap();if(!a)return"";var o=a.getZoom();return t>o||o>e?"hidden":""},MapLabel.prototype.onRemove=function(){var t=this.canvas_;t&&t.parentNode&&t.parentNode.removeChild(t)},MapLabel.prototype.onRemove=MapLabel.prototype.onRemove;
var serverLocs=[{id:1,name:"New York",lat:40.741355,lng:-74.003203,connections:["Washington DC","Chicago"]},{id:2,name:"Washington DC",lat:39.016363,lng:-77.459022,connections:["New York","Atlanta"]},{id:3,name:"Atlanta",lat:33.755456,lng:-84.39153,connections:["Washington DC","Miami","Dallas"]},{id:4,name:"Dallas",lat:32.799852,lng:-96.820433,connections:["Atlanta","Miami","Los Angeles"]},{id:5,name:"Los Angeles",lat:34.047908,lng:-118.255536,connections:["Dallas","Seattle"]},{id:6,name:"Chicago",lat:41.854159,lng:-87.619014,connections:["New York","Seattle"]},{id:7,name:"Seattle",lat:47.6143,lng:-122.3388,connections:["Los Angeles","Chicago"]},{id:8,name:"Miami",lat:25.782648,lng:-80.193157,connections:["Atlanta","Dallas"]}];